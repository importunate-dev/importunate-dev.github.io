{% comment %}
  관련 포스트 추천
  태그 기반으로 관련 포스트를 추천합니다.
{% endcomment %}

{% if page.layout == 'post' and page.tags.size > 0 %}
  {% assign max_related = 5 %}
  {% assign min_common_tags = 1 %}
  {% assign max_related_counter = 0 %}
  {% assign related_posts = '' | split: '' %}

  {% for post in site.posts %}
    {% if post.url != page.url %}
      {% assign same_tag_count = 0 %}
      {% assign common_tags = '' | split: '' %}

      {% for tag in post.tags %}
        {% if page.tags contains tag %}
          {% assign same_tag_count = same_tag_count | plus: 1 %}
        {% endif %}
      {% endfor %}

      {% if same_tag_count >= min_common_tags %}
        {% assign related_posts = related_posts | push: post %}
        {% assign max_related_counter = max_related_counter | plus: 1 %}
        {% if max_related_counter >= max_related %}
          {% break %}
        {% endif %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% if related_posts.size > 0 %}
  <div class="related-posts" style="margin-top: 60px; padding-top: 40px; border-top: 2px solid #eee;">
    <h3 style="margin-bottom: 30px; color: #333; font-size: 24px;">관련 포스트</h3>
    <div class="related-posts-list">
      {% for post in related_posts %}
      <div class="related-post-item" style="margin-bottom: 25px; padding: 20px; background: #f9f9f9; border-radius: 8px; transition: transform 0.2s;" onmouseover="this.style.transform='translateX(5px)'" onmouseout="this.style.transform='translateX(0)'">
        <h4 style="margin: 0 0 10px 0; font-size: 20px;">
          <a href="{{ post.url | prepend: site.baseurl }}" style="color: #0085a1; text-decoration: none;">
            {{ post.title }}
          </a>
        </h4>
        {% if post.subtitle %}
        <p style="margin: 0 0 10px 0; color: #777; font-size: 14px; line-height: 1.6;">
          {{ post.subtitle }}
        </p>
        {% endif %}
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; flex-wrap: wrap; gap: 5px;">
            {% for tag in post.tags limit: 3 %}
            <span style="
              display: inline-block;
              padding: 3px 8px;
              background: #e8e8e8;
              color: #666;
              border-radius: 3px;
              font-size: 11px;
            ">{{ tag }}</span>
            {% endfor %}
          </div>
          <span style="color: #999; font-size: 12px;">{{ post.date | date: "%Y.%m.%d" }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
{% endif %}
