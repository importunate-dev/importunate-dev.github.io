---
layout: subpage
---

<h1>{{ page.title | upcase }}</h1>

<!-- Search Box -->
<div style="margin-bottom: 20px">
  <input
    type="text"
    id="post-search-input"
    placeholder="ì œëª© ë˜ëŠ” ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰..."
    style="
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      font-family: 'Noto Sans KR', sans-serif;
    "
  />
</div>

<!-- Posts Count -->
<div
  id="post-count"
  style="margin-bottom: 10px; color: #777; font-size: 14px"
></div>

<!-- Posts List -->
<div id="posts-container">
  {% for post in site.posts %} {% if post.category == page.category and
  post.subcategory == page.subcategory %}
  <div
    class="post-preview searchable-post"
    style="margin-bottom: 15px"
    data-title="{{ post.title | downcase }}"
    data-subtitle="{{ post.subtitle | downcase }}"
    data-date="{{ post.date | date: '%Y.%m.%d' }}"
  >
    <a href="{{ post.url | prepend: site.baseurl }}">
      <h4
        class="post-title"
        style="margin-top: 0; margin-bottom: 5px; font-size: 18px"
      >
        {{ post.title }}
      </h4>
      {% if post.subtitle %}
      <p
        class="post-subtitle"
        style="font-size: 14px; color: #999; margin: 0 0 5px 0"
      >
        {{ post.subtitle }}
      </p>
      {% endif %}
    </a>
    <p class="post-meta" style="margin: 0; font-size: 13px; color: #777">
      {{ post.date | date: "%Y.%m.%d" }}
    </p>
  </div>
  <hr class="post-divider" style="border-top: 1px solid #ddd; margin: 15px 0" />
  {% endif %} {% endfor %}
</div>

<!-- No Results Message -->
<div id="no-results" class="no-results-message" style="display: none">
  ğŸ” ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
</div>

<!-- Pagination -->
<div id="pagination" style="text-align: center; margin-top: 30px">
  <button
    id="prev-btn"
    style="
      padding: 8px 16px;
      margin: 0 5px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer;
      border-radius: 4px;
    "
  >
    ì´ì „
  </button>
  <span id="page-numbers" style="margin: 0 10px"></span>
  <button
    id="next-btn"
    style="
      padding: 8px 16px;
      margin: 0 5px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer;
      border-radius: 4px;
    "
  >
    ë‹¤ìŒ
  </button>
</div>

<script>
  $(document).ready(function () {
    var $searchInput = $("#post-search-input");
    var $posts = $(".searchable-post");
    var $dividers = $(".post-divider");
    var $postCount = $("#post-count");
    var $noResults = $("#no-results");
    var $pagination = $("#pagination");
    var $prevBtn = $("#prev-btn");
    var $nextBtn = $("#next-btn");
    var $pageNumbers = $("#page-numbers");
    var totalPosts = $posts.length;
    var postsPerPage = 5;
    var currentPage = 1;
    var filteredPosts = [];

    // í•œê¸€ ì´ˆì„± ì¶”ì¶œ í•¨ìˆ˜
    function getChosung(text) {
      var chosung = [
        "ã„±",
        "ã„²",
        "ã„´",
        "ã„´",
        "ã„·",
        "ã„¸",
        "ã„¹",
        "ã…",
        "ã…‚",
        "ã…ƒ",
        "ã……",
        "ã…†",
        "ã…‡",
        "ã…ˆ",
        "ã…‰",
        "ã…Š",
        "ã…‹",
        "ã…Œ",
        "ã…",
        "ã…",
      ];
      var result = "";
      for (var i = 0; i < text.length; i++) {
        var code = text.charCodeAt(i) - 44032;
        if (code > -1 && code < 11172) {
          result += chosung[Math.floor(code / 588)];
        } else {
          result += text.charAt(i);
        }
      }
      return result;
    }

    // ê²€ìƒ‰ ë§¤ì¹­ í•¨ìˆ˜
    function matchesSearch(text, searchTerm) {
      if (!text) return false;
      text = String(text).toLowerCase();
      searchTerm = searchTerm.toLowerCase();

      // 1. ì§ì ‘ í¬í•¨ ê²€ìƒ‰
      if (text.indexOf(searchTerm) !== -1) return true;

      // 2. ì´ˆì„± ê²€ìƒ‰
      var textChosung = getChosung(text);
      if (textChosung.indexOf(searchTerm) !== -1) return true;

      // 3. ìœ ì‚¬ ë¬¸ì ê²€ìƒ‰ (í¸ì§‘ ê±°ë¦¬ 1 ì´í•˜)
      if (searchTerm.length >= 2) {
        for (var i = 0; i <= text.length - searchTerm.length; i++) {
          var substring = text.substr(i, searchTerm.length);
          var diff = 0;
          for (var j = 0; j < searchTerm.length; j++) {
            if (substring[j] !== searchTerm[j]) diff++;
            if (diff > 1) break;
          }
          if (diff <= 1) return true;
        }
      }

      return false;
    }

    // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
    function renderPagination() {
      var totalPages = Math.ceil(filteredPosts.length / postsPerPage);

      if (totalPages <= 1) {
        $pagination.hide();
        return;
      }

      $pagination.show();
      $prevBtn.prop("disabled", currentPage === 1);
      $nextBtn.prop("disabled", currentPage === totalPages);

      // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ ìƒì„±
      $pageNumbers.empty();
      var startPage = Math.max(1, currentPage - 2);
      var endPage = Math.min(totalPages, currentPage + 2);

      for (var i = startPage; i <= endPage; i++) {
        var $pageBtn = $("<button></button>")
          .text(i)
          .css({
            padding: "8px 12px",
            margin: "0 2px",
            border: "1px solid #ddd",
            background: i === currentPage ? "#333" : "white",
            color: i === currentPage ? "white" : "#333",
            cursor: "pointer",
            borderRadius: "4px",
          })
          .data("page", i)
          .on("click", function () {
            currentPage = $(this).data("page");
            displayPage();
          });
        $pageNumbers.append($pageBtn);
      }
    }

    // í˜„ì¬ í˜ì´ì§€ í‘œì‹œ
    function displayPage() {
      var start = (currentPage - 1) * postsPerPage;
      var end = start + postsPerPage;

      $posts.hide();
      $dividers.hide();

      for (var i = 0; i < filteredPosts.length; i++) {
        if (i >= start && i < end) {
          filteredPosts[i].post.show();
          filteredPosts[i].divider.show();
        }
      }

      renderPagination();
      window.scrollTo(0, 0);
    }

    function updatePostCount(visibleCount) {
      if ($searchInput.val().trim() === "") {
        $postCount.text("ì´ " + totalPosts + "ê°œì˜ ê¸€");
        $noResults.hide();
      } else {
        $postCount.text(
          visibleCount + "ê°œì˜ ê²€ìƒ‰ ê²°ê³¼ (ì „ì²´ " + totalPosts + "ê°œ)"
        );
        if (visibleCount === 0) {
          $noResults.show();
          $pagination.hide();
        } else {
          $noResults.hide();
        }
      }
    }

    // í•„í„°ë§ ë° í˜ì´ì§€ ì—…ë°ì´íŠ¸
    function filterAndDisplay() {
      var searchTerm = $searchInput.val().trim();
      filteredPosts = [];
      currentPage = 1;

      $posts.each(function (index) {
        var $post = $(this);
        var $divider = $dividers.eq(index);
        var title = $post.data("title") || "";
        var subtitle = $post.data("subtitle") || "";
        var date = $post.data("date") || "";

        if (
          searchTerm === "" ||
          matchesSearch(title, searchTerm) ||
          matchesSearch(subtitle, searchTerm) ||
          matchesSearch(date, searchTerm)
        ) {
          filteredPosts.push({ post: $post, divider: $divider });
        }
      });

      updatePostCount(filteredPosts.length);
      displayPage();
    }

    // ì´ˆê¸° í‘œì‹œ
    filterAndDisplay();

    // ê²€ìƒ‰ ì…ë ¥ ì´ë²¤íŠ¸
    $searchInput.on("input", filterAndDisplay);

    // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸
    $prevBtn.on("click", function () {
      if (currentPage > 1) {
        currentPage--;
        displayPage();
      }
    });

    $nextBtn.on("click", function () {
      var totalPages = Math.ceil(filteredPosts.length / postsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        displayPage();
      }
    });
  });
</script>
